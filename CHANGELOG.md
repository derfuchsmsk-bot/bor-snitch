# История Изменений

## [2026-01-26]

### Добавлено
- **Динамическая Конфигурация**: Создан файл `src/utils/game_config.py` для централизованного хранения всех игровых констант (очки, ранги, лимиты, вероятности).
- **Поддержка Стикеров**: Бот теперь логирует и распознает стикеры (как `[STICKER] {emoji}`). Пользователи могут кидать репорты на стикеры, и AI учитывает их в контексте.
- **Случайные Циничные Комментарии**: Бот теперь имеет шанс 2% вставить свой циничный/остроумный комментарий на текстовые сообщения (с кулдауном 1 час на чат).
- **Скрипт Еженедельной Амнистии**: Добавлен `src/scripts/run_weekly_amnesty.py` для ручного запуска процесса амнистии.

### Изменено
- **Система Амнистии**: 
    - Заменена глобальная логика "деления всех очков на 2".
    - **Новая Логика**: Теперь только очки, набранные **за последние 7 дней**, делятся пополам и вычитаются из общего счета. Это балансирует экономику, снижая влияние недавних "косяков", но сохраняя историю заядлых рецидивистов.
- **Система Доносов**:
    - Увеличен лимит контекста для команды `/report` с 5 до **25 сообщений**.
    - Добавлены **относительные временные метки** (например, "(2 мин назад)") в контекст, передаваемый AI, чтобы он мог различать мгновенные ответы и реакцию с задержкой.
- **AI Инструкции (Промпты)**:
    - Обновлен `SYSTEM_PROMPT`: теперь явно разрешена "дружеская прожарка" (roasting), которая не считается токсичностью, если контекст соответствующий.
    - Промпты теперь динамически подставляют значения очков из `game_config.py`.
- **База Данных**:
    - Рефакторинг `src/services/db.py` для поддержки новой логики амнистии и штрафов за AFK на основе конфига.

### Удалено
- Удалены жестко заданные "Магические Числа" (Magic Numbers) из `src/services/ai.py`, `src/bot/handlers.py` и `src/services/db.py`.
